!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=56)}([function(e,t,n){var r=n(10),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();e.exports=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e),this.LIBRARY="iVXjs",this.DELIMETER=":"}return o(e,[{key:"convention",value:function(){return this.LIBRARY}},{key:"addNames",value:function(e){var t=this;Object.keys(e).forEach(function(n,r){t[n]=t.convention(e[n])})}}]),e}();t.default=i},function(e,t,n){function r(e,t){var n=i(e,t);return o(n)?n:void 0}var o=n(30),i=n(33);e.exports=r},function(e,t,n){function r(e){return null==e?void 0===e?s:u:c&&c in Object(e)?i(e):a(e)}var o=n(9),i=n(23),a=n(24),u="[object Null]",s="[object Undefined]",c=o?o.toStringTag:void 0;e.exports=r},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=t.TypeValidator=function(){function e(){r(this,e)}return i(e,[{key:"isObject",value:function(e){var t=void 0===e?"undefined":o(e);return null!=e&&("object"==t||"function"==t)}},{key:"isUndefined",value:function(e){return void 0===e||null===e}},{key:"isString",value:function(e){return"[object String]"===this.toString.call(e)}},{key:"isFunction",value:function(e){return e&&"[object Function]"===this.toString.call(e)}},{key:"isNumber",value:function(e){return!isNaN(e)}},{key:"isBoolean",value:function(e){return"boolean"==typeof e||"object"===(void 0===e?"undefined":o(e))&&"boolean"==typeof e.valueOf()}},{key:"isEmpty",value:function(e){var t=Object.prototype.hasOwnProperty,n=Array.isArray(e),r="string"==typeof e,o=n||r;if(o&&0===e.length)return!0;if(o&&e.length>0)return!1;if(!isNaN(e))return!1;if(void 0===e)return!0;if(null===e)return!0;for(var i in e)if(t.call(e,i))return!1;return!0}},{key:"toString",get:function(){return Object.prototype.toString}}]),e}(),u=new a;t.ObjectParsers=function(){function e(){r(this,e)}return i(e,[{key:"mapKeys",value:function(e,t){if(!e||e==={})return[];var n=Object.keys(e),r=n.reduce(function(t,n){var r=[n,e[n]];return t.push(r),t},[]),o=new Map(r),i=[];return o?(o.forEach(function(e,n){i.push(t(e,n))}),i):[]}},{key:"merge",value:function(e,t,n){var r=Object.keys(t),o=new Object(e);return r.forEach(function(e,r){n&&n.indexOf(e)>=0||(o[e]=t[e])}),o}},{key:"reduce",value:function(e,t,n){if(e&&e!=={}){var r=Object.keys(e),o=r.reduce(function(t,n){var r=[n,e[n]];return t.push(r),t},[]);return new Map(o).forEach(function(e,r){n=t(n,e,r)}),n}}},{key:"anyEmpty",value:function(e,t){var n={isEmpty:!1,errors:[]};return e.forEach(function(e,r){t.forEach(function(t){u.isEmpty(e[t])&&(n.isEmpty=!0,n.errors.push({key:t,index:r,value:e[t]}))})}),n}},{key:"has",value:function(e,t){return Array.isArray(t)?this.hasSameArray(e,t):"object"===(void 0===t?"undefined":o(t))?this.hasSameObject(e,t):e.indexOf(t)>=0}},{key:"hasSameObject",value:function(e,t){var n=!1;return e.forEach(function(e,r){if("object"===(void 0===e?"undefined":o(e))){Object.keys(e).forEach(function(r,o){n=e[r]===t[r]})}}),n}},{key:"hasSameArray",value:function(e,t){var n=!1;return e.forEach(function(e,r){Array.isArray(e)&&e.forEach(function(e,r){n=e===t[r]})}),n}},{key:"setValue",value:function(e,t,n){for(var r=t.split("."),o=e,i=0;i<r.length-1;i++){var a=r[i];a in o?o=o[a]:(o[a]={},o=o[a])}o[r[r.length-1]]=n}},{key:"getValueFromPath",value:function(e,t){var n=e.split("."),r=t,o={},i=void 0;return n.forEach(function(e,t){if(!u.isEmpty(e)){if(o=r[e],u.isEmpty(o))return void(i=o);i=o,r=o}}),i}},{key:"isUnique",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={isUnique:!0,errors:[]},r={},o=this;return t.forEach(function(t){r[t]=[],e.forEach(function(e,i){o.has(r[t],e[t])?(n.errors.push({key:t,index:i,value:e[t]}),n.isUnique=!1):r[t].push(e[t])})}),n}}]),e}()},function(e,t,n){function r(e){if(!i(e))return!1;var t=o(e);return t==u||t==s||t==a||t==c}var o=n(3),i=n(11),a="[object AsyncFunction]",u="[object Function]",s="[object GeneratorFunction]",c="[object Proxy]";e.exports=r},function(e,t){function n(e){return null!=e&&"object"==typeof e}e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(17),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n={CHANGE:"change",SUCCESS:"success",ERROR:"error",GO:"go",NOT_FOUND:"not-found",GET_STATE:"get-state",REQUEST_STATE:"request-state"};return e.addNames(n),e}return i(t,e),a(t,[{key:"convention",value:function(e){var n=this.DELIMETER;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+n+e}}]),t}(c.default);t.default=l},function(e,t,n){var r=n(0),o=r.Symbol;e.exports=o},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(t,n(22))},function(e,t){function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}e.exports=n},function(e,t){function n(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}var r=Object.prototype;e.exports=n},function(e,t){function n(e){if(null!=e){try{return o.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var r=Function.prototype,o=r.toString;e.exports=n},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}var r=9007199254740991;e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),a=n(6),u=function(e){return e&&e.__esModule?e:{default:e}}(a),s=(new i.TypeValidator,Object.prototype.hasOwnProperty),c=function(){function e(t,n){r(this,e),this.experience=t,this.customEvaluator=n}return o(e,[{key:"setCustomEvaluator",value:function(e){Object.assign(this,{customEvaluator:customEvaluator})}},{key:"evaluate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1},n=this,r=e.conditionOperator,o=void 0===r?"and":r,i=e.conditions,a=i.map(function(e,r){var o=e.key,i=e.is,a=e.value,s=e.type,c=void 0===s?"input":s,l=t(e);return!l&&n.customEvaluator&&(0,u.default)(n.customEvaluator)&&(l=n.customEvaluator(e)),!l&&n[o]&&(l=n[o](o,i,a)),!l&&n[c]&&(l=n[c](o,i,a)),l});return this[o](a)}},{key:"input",value:function(e,t,n){var r=this.experience,o=r.data[e];return!!this[t]&&this[t](o,n)}},{key:"and",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t,n){return e&&t},!0)}},{key:"or",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t,n){return e||t},!1)}},{key:"not",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t,n){return e&&!t},!0)}},{key:"lte",value:function(e,t){return!isNaN(e)&&!isNaN(t)&&new Number(e)<=new Number(t)}},{key:"lt",value:function(e,t){return!isNaN(e)&&!isNaN(t)&&new Number(e)<new Number(t)}},{key:"gte",value:function(e,t){return!isNaN(e)&&!isNaN(t)&&new Number(e)>=new Number(t)}},{key:"gt",value:function(e,t){return!isNaN(e)&&!isNaN(t)&&new Number(e)>new Number(t)}},{key:"equals",value:function(e,t){return e===t}},{key:"notEquals",value:function(e,t){return e!==t}},{key:"in",value:function(e,t){return e&&e.indexOf&&e.indexOf(t)>=0}},{key:"empty",value:function(e,t){if(null===e)return!0;if(Array.isArray(e)||"string"==typeof value)return!e.length;for(var n in e)if(s.call(e,n))return!1;return!0}}]),e}();t.default=c},function(e,t,n){function r(e){if(null==e)return!0;if(s(e)&&(u(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||f(e)||a(e)))return!e.length;var t=i(e);if(t==p||t==v)return!e.size;if(l(e))return!o(e).length;for(var n in e)if(d.call(e,n))return!1;return!0}var o=n(25),i=n(28),a=n(38),u=n(40),s=n(41),c=n(42),l=n(12),f=n(44),p="[object Map]",v="[object Set]",h=Object.prototype,d=h.hasOwnProperty;e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(1),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.STATE="state",e}return i(t,e),a(t,[{key:"convention",value:function(){var e=this.DELIMETER,n=this.STATE;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+e+n}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(19),u=r(a),s=n(8),c=r(s);t.Actions=function(){function e(){o(this,e),this.data={},this.audioEventNames=new u.default,this.stateEventNames=new c.default}return i(e,[{key:"setElementClasses",value:function(e,t){var n=t.animationClasses,r=void 0===n?"":n,o=e.animationClasses,i=void 0===o?"":o,a=r.split(" "),u=i.split(" ");return e.className.indexOf("hide")>=0?void(e.className=e.className.replace("hide",r)):(u.forEach(function(t){t.length>0&&e.classList.remove(t)}),a.forEach(function(t){t.length>0&&e.classList.add(t)}),e.animationClasses=r,e)}},{key:"addClasses",value:function(e){var t=e.element,n=e.classes,r=void 0===n?"":n,o=this._getArrayFromAllSelector(t),i=this._getClassNames(r);o.forEach(function(e){i.forEach(function(t){e.classList.add(t)})})}},{key:"removeClasses",value:function(e){var t=e.element,n=e.classes,r=void 0===n?"":n,o=this._getArrayFromAllSelector(t),i=this._getClassNames(r);o.forEach(function(e){i.forEach(function(t){e.classList.remove(t)})})}},{key:"_getClassNames",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e&&e.split?e.split(" "):[]}},{key:"_getArrayFromAllSelector",value:function(e){var t=document.querySelectorAll(e);return!t||t.length<=0?[]:Array.from(t)}},{key:"goToNextState",value:function(e){var t=this,n=e.next,r=this,o=this.rules(n);return new Promise(function(e,n){o&&(t.Bus.emit(r.stateEventNames.GO,{stateId:o}),e())})}},{key:"animateElement",value:function(e){var t=this,n=e.element,r=document.querySelectorAll(n);if(r&&!(r.length<=0)){r=Array.from(r),r.forEach(function(n,r){n=t.setElementClasses(n,e)});return new Promise(function(t,n){function o(n){r.forEach(function(t,n){i.forEach(function(n){t.animationClasses=e.animationClasses,t.removeEventListener(n,o)})}),t()}var i=["webkitAnimationEnd","mozAnimationEnd","MSAnimationEnd","osanimationend","animationend"];i.forEach(function(e){r.forEach(function(t,n){t.addEventListener(e,o)})})})}}},{key:"goToState",value:function(e,t){e.state;t&&t.emit(this.stateEventNames.GO,e)}},{key:"playAudioClip",value:function(e){var t=this.audioEventNames,n=this;return e&&(this.Bus.emit(t.SET_UP,e),this.Bus.emit(t.PLAY)),this.Bus.on(t.TIME_UPDATE,function(t){t.id===e.id&&t.runCuePoints(n.processor)}),new Promise(function(r,o){n.Bus.once(t.ENDED,function(t){t.id===e.id&&n.processor.resolveActions(e.onEnd,function(){r()})})})}},{key:"setData",value:function(e){var t=e.key,n=e.value,r=this;return new Promise(function(e,o){r.data[t]=n,r.Log.debug("Current Experience Data",{group:!0,messages:Object.keys(r.data).map(function(e,t){return{message:e+":"+r.data[e],data:r.data[e]}})},r.data),e(r)})}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(20),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n={ADD_PLAYING_CLASS:"add-playing-class",BUFFERING:"buffering",CAN_PLAY:"can-play",DISPOSE:"dispose",ENDED:"ended",GET_DURATION:"get-duration",MUTE:"mute",PAUSE:"pause",PAUSED:"paused",PLAY:"play",PLAYING:"playing",SEEK:"seek",SET_UP:"set-up",SET_DURATION:"set-duration",SET_VOLUME:"set-volume",VOLUME:"set-volume",TIME_UPDATE:"time-update",UNMUTE:"unmute"};return e.addNames(n),e}return i(t,e),a(t,[{key:"convention",value:function(e){var n=this.DELIMETER;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+n+e}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(1),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.AUDIO="audio",e}return i(t,e),a(t,[{key:"convention",value:function(){var e=this.DELIMETER,n=this.AUDIO;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+e+n}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Rules=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(15),u=r(a),s=n(16),c=r(s);t.Rules=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{data:{}},n=arguments[1];o(this,e),Object.assign(this,{experience:t,evaluator:new u.default(t,n)})}return i(e,[{key:"processRules",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!1};return t?this.processStateRules(e):this.findMatchngRule(e,n)}},{key:"processStateRules",value:function(e){Array.isArray(e)||(e=[]);var t=this.findMatchngRule(e),n=t.stateId,r=void 0===n?"":n,o=t.route;return o||r}},{key:"findMatchngRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1},n=this;return e.find(function(e){var r=e.rule;return n.getMatchingRule(r,t)})||{}}},{key:"getMatchingRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1},n=this.evaluator;if((0,c.default)(e))return!0;var r=e.conditions,o=e.conditionOperator,i=void 0===o?"and":o;return r||(e.conditionOperator=i,e.conditions=[e]),n.evaluate(e,t)}},{key:"addEvaluator",value:function(e,t){this.evaluator[e]=t}},{key:"rules",get:function(){var e=this;return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!1};return e.processRules(t,n,r)}}}]),e}()},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){function r(e){var t=a.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var o=u.call(e);return r&&(t?e[s]=n:delete e[s]),o}var o=n(9),i=Object.prototype,a=i.hasOwnProperty,u=i.toString,s=o?o.toStringTag:void 0;e.exports=r},function(e,t){function n(e){return o.call(e)}var r=Object.prototype,o=r.toString;e.exports=n},function(e,t,n){function r(e){if(!o(e))return i(e);var t=[];for(var n in Object(e))u.call(e,n)&&"constructor"!=n&&t.push(n);return t}var o=n(12),i=n(26),a=Object.prototype,u=a.hasOwnProperty;e.exports=r},function(e,t,n){var r=n(27),o=r(Object.keys,Object);e.exports=o},function(e,t){function n(e,t){return function(n){return e(t(n))}}e.exports=n},function(e,t,n){var r=n(29),o=n(34),i=n(35),a=n(36),u=n(37),s=n(3),c=n(13),l=c(r),f=c(o),p=c(i),v=c(a),h=c(u),d=s;(r&&"[object DataView]"!=d(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=d(new o)||i&&"[object Promise]"!=d(i.resolve())||a&&"[object Set]"!=d(new a)||u&&"[object WeakMap]"!=d(new u))&&(d=function(e){var t=s(e),n="[object Object]"==t?e.constructor:void 0,r=n?c(n):"";if(r)switch(r){case l:return"[object DataView]";case f:return"[object Map]";case p:return"[object Promise]";case v:return"[object Set]";case h:return"[object WeakMap]"}return t}),e.exports=d},function(e,t,n){var r=n(2),o=n(0),i=r(o,"DataView");e.exports=i},function(e,t,n){function r(e){return!(!a(e)||i(e))&&(o(e)?h:c).test(u(e))}var o=n(6),i=n(31),a=n(11),u=n(13),s=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,l=Function.prototype,f=Object.prototype,p=l.toString,v=f.hasOwnProperty,h=RegExp("^"+p.call(v).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},function(e,t,n){function r(e){return!!i&&i in e}var o=n(32),i=function(){var e=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=r},function(e,t,n){var r=n(0),o=r["__core-js_shared__"];e.exports=o},function(e,t){function n(e,t){return null==e?void 0:e[t]}e.exports=n},function(e,t,n){var r=n(2),o=n(0),i=r(o,"Map");e.exports=i},function(e,t,n){var r=n(2),o=n(0),i=r(o,"Promise");e.exports=i},function(e,t,n){var r=n(2),o=n(0),i=r(o,"Set");e.exports=i},function(e,t,n){var r=n(2),o=n(0),i=r(o,"WeakMap");e.exports=i},function(e,t,n){var r=n(39),o=n(7),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(e){return o(e)&&a.call(e,"callee")&&!u.call(e,"callee")};e.exports=s},function(e,t,n){function r(e){return i(e)&&o(e)==a}var o=n(3),i=n(7),a="[object Arguments]";e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){function r(e){return null!=e&&i(e.length)&&!o(e)}var o=n(6),i=n(14);e.exports=r},function(e,t,n){(function(e){var r=n(0),o=n(43),i="object"==typeof t&&t&&!t.nodeType&&t,a=i&&"object"==typeof e&&e&&!e.nodeType&&e,u=a&&a.exports===i,s=u?r.Buffer:void 0,c=s?s.isBuffer:void 0,l=c||o;e.exports=l}).call(t,n(4)(e))},function(e,t){function n(){return!1}e.exports=n},function(e,t,n){var r=n(45),o=n(46),i=n(47),a=i&&i.isTypedArray,u=a?o(a):r;e.exports=u},function(e,t,n){function r(e){return a(e)&&i(e.length)&&!!u[o(e)]}var o=n(3),i=n(14),a=n(7),u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Arguments]"]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u["[object Map]"]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u["[object Set]"]=u["[object String]"]=u["[object WeakMap]"]=!1,e.exports=r},function(e,t){function n(e){return function(t){return e(t)}}e.exports=n},function(e,t,n){(function(e){var r=n(10),o="object"==typeof t&&t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,a=i&&i.exports===o,u=a&&r.process,s=function(){try{return u&&u.binding&&u.binding("util")}catch(e){}}();e.exports=s}).call(t,n(4)(e))},,,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(52),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.AUTHENTICATION="auth";var n={REQUEST_PASSWORD:"request-password",GET_PASSWORD:"get-password",ACCOUNT_EXISTS:"account-exists-with-different-credential"};return e.addNames(n),e}return i(t,e),a(t,[{key:"convention",value:function(e){var n=this.DELIMETER,r=this.AUTHENTICATION;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+n+r+n+e}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(1),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.FIREBASE="firebase",e}return i(t,e),a(t,[{key:"convention",value:function(){var e=this.DELIMETER,n=this.FIREBASE;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+e+n}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),a=new i.ObjectParsers,u=new i.TypeValidator,s=function(){function e(){r(this,e)}return o(e,[{key:"addRemoteTemplates",value:function(e,t){function n(e,t,n,r,o){var i=e.path,s=e.templateKey,l=(e.keys,a.getValueFromPath(i,t));if(!u.isEmpty(l)){l.map(function(e,t){var u=a.getValueFromPath(s,e);u&&(n.push(c.child(u).getDownloadURL()),r.push(o+"."+i+"."+t+"."+s))})}}var r=this.templateLocations,o=JSON.parse(JSON.stringify(e)),i=o.states,s=firebase.storage(),c=s.ref("/");return new Promise(function(e,t){var s=[],l=[];i.forEach(function(e,t){var o=e.type;r[o].forEach(function(r,o){if(u.isString(r)){var i=a.getValueFromPath(r,e);i&&(s.push(c.child(i).getDownloadURL()),l.push("states."+t+"."+r))}else{var f=r.path,p=r.keys,v=void 0===p?[]:p,h=e[f];n(r,e,s,l,"states."+t),v.forEach(function(e,r){Array.isArray(h)&&h.forEach(function(o,i){n(e,o,s,l,"states."+t+"."+f+"."+r)})})}})}),Promise.all(s).then(function(t){o.templates=t,$.support.cors=!0,$.get(t[0]).then(function(e){}),e(o)},function(e){console.dir(e),t(e)})})}},{key:"detokenize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console,o=(n.data,n.key),i=null==t?{}:t,s=i.uid,c=e.replace(/\$uid/g,function(e){return s||e}).replace(/\$x.key/g,function(e){return o||e}).replace(/\$x.data.[a-z,A-Z,0-9]*/g,function(e){var t=a.getValueFromPath(e,n);return u.isString(t)||u.isBoolean(t)||u.isNumber(t)?t:(r.warn(e+" is invalid. Make sure this value is a String, Boolean, or Number."),e)}),l=c.indexOf("$uid")>=0,f=c.indexOf("$x.key")>=0,p=c.indexOf("$x.data")>=0,v=l||f||p;return l&&r.warn("This link can't be detokenized because this path because there is no Authorized User."),f&&r.warn("This link can't be detokenized because this path because there is no active experience."),v?!v:c}},{key:"templateLocations",get:function(){return{input:["header.templateUrl","footer.templateUrl","form.labelTemplateUrl","form.submit.labelTemplateUrl",{path:"inputs",templateKey:"labelTemplateUrl",keys:[{path:"buttons",templateKey:"labelTemplateUrl"},{path:"radioButtons",templateKey:"labelTemplateUrl"}]}],navigation:["header.templateUrl","footer.templateUrl",{path:"links",templateKey:"labelTemplateUrl"}],html:["templateUrl"],video:["header.templateUrl","footer.templateUrl",{path:"personalizations",templateKey:"templateUrl"}]}}}]),e}();t.default=s},,,function(e,t,n){"use strict";(function(e){function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e.module=O,e}Object.defineProperty(t,"__esModule",{value:!0}),t.FirebaseData=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(5),s=n(57),c=r(s),l=n(8),f=(r(l),n(51)),p=r(f),v=n(18),h=n(59),d=n(53),y=r(d),b=n(60),g=r(b),m=(new v.Actions,new u.ObjectParsers),E=new y.default,O=t.FirebaseData=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=arguments[2],r=arguments[3];o(this,e);var i=t.data,a=t.experience,u=(a.data,i.apiKey),s=i.authDomain,c=i.databaseURL,l=i.storageBucket,f=i.auth,v=void 0!==f&&f,h=i.createExperienceOnLoad,d=void 0===h||h,y=i.experiencePath,b=void 0===y?"experiences":y,g=i.localTemplates,m=void 0!==g&&g,E=i.templateRef;this.iVXjsSettings=t,this.Bus=n,this.iVXjsLog=r;var O={apiKey:u,authDomain:s,databaseURL:c,storageBucket:l};firebase.initializeApp(O),this.auth=v,this.databaseURL=c,this.firebaseConstants=new p.default,this.createExperienceOnLoad=d,this.experiencePath=b,this.localTemplates=m,this.defaultExperience=a,this.templateRef=E}return a(e,[{key:"setUpExperience",value:function(e,t,n){function r(e){firebase.auth().getRedirectResult().then(function(t){var n=t.user;if(!l)return void o(e);if(n&&localStorage){var r=localStorage,u=r.redirectOrigin,s=JSON.parse(u),c=t.user;t.crediential;i(c,s,e)}else a(e)}).catch(function(e){j.Bus.emit(b.ACCOUNT_EXISTS,e),console.dir(e);var t={message:"Firebase couldn't authenticate with email, "+e.email+", due to error code "+e.code+". \n            You can handle this error by listening for event: "+b.ACCOUNT_EXISTS+".",type:"FIREBASE:AUTHENTICATION"};O.error(t,"Firebase")})}function o(e){var r=firebase.auth().currentUser;A.src=t,A.user=r,A.iVXjsLog=j.iVXjsLog;var o={config:e,experience:x,rules:new h.Rules(A,T).rules};n(o)}function i(e,t,r){var o=t.key,i=t.next;A.key=o,A.user=e,A.iVXjsLog=j.iVXjsLog,j.Bus.once((new c.default).VALIDATED,function(e){e.experience.goToNextState({next:i})});var a={config:r,experience:x,rules:new h.Rules(A,T).rules};_.ref("users/"+e.uid).once("value").then(function(t){if(null===t.val()){var r={};r[e.uid]={email:e.email},_.ref("users").set(r).then(function(t){u(e,o,n,a)})}else{var i=t.val();i.uid=e.uid,u(i,o,n,a)}})}function a(e){var r=firebase.auth().currentUser,o={src:t},i=E.detokenize(p,r,f),a=void 0;r&&(o.user={},o.user[r.uid]=!0,A.user=r),i&&(a=firebase.database().ref(i).push(o).key),A.key=a,A.auth=s,A.src=t,A.iVXjsLog=j.iVXjsLog;var c={config:e,experience:x,rules:new h.Rules(A,T).rules};if(r&&i)return A.user=r,void _.ref("users/"+r.uid).once("value").then(function(e){if(null===e.val()){var t={},o={email:r.email,name:r.displayName,photoURL:r.photoURL,uid:r.uid};t[r.uid]=o,_.ref("users").set(t).then(function(e){u(o,a,n,c)})}else{var i=e.val(),s=i.uid,l=void 0===s?r.uid:s,f=i.email,p=void 0===f?r.email:f,v=i.name,h=void 0===v?r.displayName:v,d=i.avatar,y=void 0===d?r.photoURL:d,b=i.experiences;u({uid:l,email:p,name:h,avatar:y,experiences:void 0===b?{}:b},a,n,c)}});n(c)}function u(e,t,n,r){var o=e.experiences,i=void 0===o?{}:o,a=e.uid;delete e.uid,i[t]=!0,e.experiences=i,_.ref("users/"+a).update(e),n(r)}var s=this.auth,l=this.createExperienceOnLoad,f=this.defaultExperience,p=this.experiencePath,d=this.localTemplates,y=this.templateRef,b=this.firebaseConstants,O=this.iVXjsLog,j=this,_=firebase.database(),w=this.iVXjsSettings,k=w.experience,P=void 0===k?{}:k,T=w.rules,A=(w.ui,w.validation,m.merge(new v.Actions,P)),x=m.merge(A,new g.default(this.iVXjsLog).experienceActions);A.experiencePath=p,d?r(e):E.addRemoteTemplates(e,y).then(function(e){r(e)})}},{key:"enhance",value:function(){var e=this,t=(e.auth,e.iVXjsSettings),n=(e.databaseURL,t.config),r=firebase.database();return new Promise(function(t,o){r.ref(n).once("value").then(function(r){e.setUpExperience(r.val(),n,t)})})}}]),e}();e.export=i,angular&&angular.module("ivx-js")&&angular.module("ivx-js").constant("iVXjs.data.firebase",i).constant("iVXjsDataFirebase",i).provider("iVXjsFirebaseUtilities",function(){this.utilities=new y.default,this.$get=function(){}})}).call(t,n(4)(e))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(58),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n={VALIDATED:"validated",NOT_VALID:"not-valid",ANALYTICS_SET:"analytics-set",ANALYTICS_FINISHED:"analytics-finished"};return e.addNames(n),e}return i(t,e),a(t,[{key:"convention",value:function(e){var n=this.DELIMETER;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+n+e}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(1),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.CONFIG="config",e}return i(t,e),a(t,[{key:"convention",value:function(){var e=this.DELIMETER,n=this.CONFIG;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+e+n}}]),t}(c.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Rules=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(21);t.Rules=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{data:{}},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.experience=e,i.customRules=n,i}return i(t,e),a(t,[{key:"processRules",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,n=e.find(function(e){return e.rule&&e.rule.key&&"auth"===e.rule.key?firebase.auth().currentUser:t.evaluateRules(e)});return n||""}},{key:"rules",get:function(){var e=this;return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=e.customRules(t);if(n)return n;var r=e.processRules(t).stateId;e.experience.config.states.find(function(e,t){return r===e.id});return r}}}]),t}(u.Rules)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(51),u=r(a),s=n(61),c=r(s),l=n(5),f=n(8),p=r(f),v=n(53),h=r(v),d=(new l.ObjectParsers,new l.TypeValidator,new h.default),y=function(){function e(t){o(this,e),this.iVXjsLog=t,this.authConstants=new u.default,this.stateEventNames=new p.default,this.eventConstants=new c.default}return i(e,[{key:"getExternalTemplates",value:function(e){if(!this.localTemplates&&e){return firebase.storage().ref(e).getDownloadURL()}}},{key:"uploadFile",value:function(e){var t=firebase.auth().currentUser,n=e.name;if(t){var r=t.uid;return firebase.storage().ref("/"+r+"/"+n).put(e)}}},{key:"createExperience",value:function(e){var t=e.data,n=void 0===t?{}:t,r=this.experiencePath,o=this.data,i=this.src,a=firebase.database(),u=this;return new Promise(function(e,t){u.Bus.once(u.stateEventNames.GET_STATE,function(t){n.src=i,n.stateSrc=t.data.id;var s=(t.data,d.detokenize(r,u.user,u,u.iVXjsLog),firebase.auth()),l=s.currentUser;l&&(n.user={},n.user[l.uid]=!0);var f=a.ref(d.detokenize(r,u.user,u,u.iVXjsLog)).push(n).key,p=new c.default;if(u.key=f,u.data=n,l){var v=l.uid;a.ref("users/"+v).once("value").then(function(t){var n=t.val(),r=n.experiences;if(r)r[f]=!0,a.ref("users/"+v).update({experiences:r}),u.Bus.emit(p.CREATE_EXPERIENCE,t,f,l),e(f,l);else{var o={};o[f]=!0,a.ref("users/"+v).update({experiences:o})}})}else u.Bus.emit(p.CREATE_EXPERIENCE,o,f),e(f)}),u.Bus.emit(u.stateEventNames.REQUEST_STATE)})}},{key:"isRestricted",value:function(){return new Promise(function(e,t){firebase.auth().onAuthStateChanged(function(t){e(!t)})})}},{key:"signOutUser",value:function(){return firebase.auth().signOut()}},{key:"signInWithGithub",value:function(e,t){var n=this,r=new firebase.auth.GithubAuthProvider;this.key,firebase.auth();this.Bus.once(this.stateEventNames.GET_STATE,function(e){var t=e.data;n.handleRedirect(t,r)}),this.Bus.emit(this.stateEventNames.REQUEST_STATE)}},{key:"signInAnonymously",value:function(e,t){this.key;firebase.auth().signInAnonymously().catch(function(e){})}},{key:"handleRedirect",value:function(e,t,n){var r=n.scope;(void 0===r?[]:r).forEach(function(e,n){t.addScope&&t.addScope(e)}),e.key=this.key,localStorage&&(localStorage.redirectOrigin=JSON.stringify(e)),firebase.auth().signInWithRedirect(t)}},{key:"signInWithGoogle",value:function(e,t){var n=this,r=this.key,o=new firebase.auth.GoogleAuthProvider;({})[r]=!0,this.Bus.once(this.stateEventNames.GET_STATE,function(t){var r=t.data;n.handleRedirect(r,o,e)}),this.Bus.emit(this.stateEventNames.REQUEST_STATE)}},{key:"signInWithTwitter",value:function(e,t){var n=this,r=new firebase.auth.TwitterAuthProvider;this.key;this.Bus.once(this.stateEventNames.GET_STATE,function(e){var t=e.data;n.handleRedirect(t,r)}),this.Bus.emit(this.stateEventNames.REQUEST_STATE)}},{key:"signInWithFacebook",value:function(e,t){var n=this,r=new firebase.auth.FacebookAuthProvider;this.key;this.Bus.once(this.stateEventNames.GET_STATE,function(e){var t=e.data;n.handleRedirect(t,r)}),this.Bus.emit(this.stateEventNames.REQUEST_STATE)}},{key:"setUpUsers",value:function(e,t,n){firebase.database().ref("users/"+e.uid).update({email:e.email}),firebase.database().ref("users/"+e.uid+"/experiences/"+t).set(!0),n(e)}},{key:"signInWithEmail",value:function(e,t){function n(n){var i=e.emailKey,a=r.data,u=a[i];firebase.auth().createUserWithEmailAndPassword(u,n).then(function(e){r.setUpUsers(e,o,t)}).catch(function(e){e.code,e.message})}var r=this,o=this.key;this.Bus.once(this.authConstants.GET_PASSWORD,n),this.Bus.emit(this.authConstants.REQUEST_PASSWORD)}},{key:"signInUser",value:function(e,t,n){switch(e){case"google":return void this.signInWithGoogle(t,n);case"email":return void this.signInWithEmail(t,n);case"facebook":return void this.signInWithFacebook(t,n);case"twitter":return void this.signInWithTwitter(t,n);case"github":return void this.signInWithGithub(t,n);case"anonymous":this.signInAnonymously(t,n)}n()}},{key:"authorizeUser",value:function(e){var t=e.authType,n=this,r=n.key;return new Promise(function(o,i){firebase.auth().onAuthStateChanged(function(i){if(i){var a=i.uid,u=i.email,s=void 0===u?"":u,c=i.displayName;firebase.database().ref("users/"+i.uid).update({email:i.email}),r&&firebase.database().ref("users/"+i.uid+"/experiences/"+r).set(!0),n.data.user={uid:a,email:s,displayName:c},o(i)}else n.signInUser(t,e,o)})})}},{key:"setData",value:function(e){var t=this,n=firebase.database(),r=(t.data,t.key),o=(t.auth,t.iVXjsLog),i=t.experiencePath,a=e.key,u=e.value,s=e.ref,c=e.user,l=void 0!==c&&c,f={},p=firebase.auth().currentUser,v=d.detokenize(i+"/$x.key",t.user,t,o);if(s||r||l){if(!p&&l)return void o.warn("Authorization Required. Key: "+a+" Value: "+u+" was not saved to the Firebase Database.");if(f[a]=u,p&&l){var h=p.uid;return n.ref("users/"+h).update(f).then(function(){t.user[a]=u})}if(s){var y=d.detokenize(s,t.user,t,o);if(y)return n.ref(y).update(f).then(function(){})}return v?n.ref(v).update(f).then(function(){t.data[a]=u}):new Promise(function(e,t){e()})}}},{key:"experienceActions",get:function(){return{authorizeUser:this.authorizeUser,eventListeners:this.eventListeners,signInUser:this.signInUser,signOutUser:this.signOutUser,signInWithGoogle:this.signInWithGoogle,signInWithFacebook:this.signInWithFacebook,signInWithTwitter:this.signInWithTwitter,signInWithEmail:this.signInWithEmail,signInWithGithub:this.signInWithGithub,signInAnonymously:this.signInAnonymously,handleRedirect:this.handleRedirect,setUpUsers:this.setUpUsers,setData:this.setData,authConstants:this.authConstants,stateEventNames:this.stateEventNames,uploadFile:this.uploadFile,isRestricted:this.isRestricted,addEventListeners:this.addEventListners,createExperience:this.createExperience,getExternalTemplates:this.getExternalTemplates}}}]),e}();t.default=y},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(52),c=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n={CREATE_EXPERIENCE:"create-experience"};return e.addNames(n),e}return i(t,e),a(t,[{key:"convention",value:function(e){var n=this.DELIMETER;return""+u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"convention",this).call(this)+n+e}}]),t}(c.default);t.default=l}]);